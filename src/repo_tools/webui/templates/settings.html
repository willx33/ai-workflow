{% extends "base.html" %}

{% block title %}Settings - Repo Tools{% endblock %}

{% block content %}
<div class="page-header">
    <h2>Settings</h2>
    <p>Customize your Repo Tools experience</p>
</div>

<div class="workflow-container">
    <div class="workflow-step">
        <h3>UI Preferences</h3>
        
        <div class="form-group">
            <label for="matrix-toggle">Matrix Effect</label>
            <div class="toggle-switch">
                <input type="checkbox" id="matrix-toggle" class="toggle-input">
                <label for="matrix-toggle" class="toggle-label"></label>
                <span class="toggle-text">Enable the Matrix-style background effect</span>
            </div>
        </div>
    </div>
    
    <div class="workflow-step">
        <h3>Cache Management</h3>
        
        <div class="form-group">
            <p class="settings-description">Clear temporary files and cached data from cloned repositories.</p>
            <button id="clear-cache-button" class="btn btn-warning">Clear Cache</button>
        </div>
    </div>
</div>

<div id="notification" class="notification hidden">
    <div class="notification-content">
        <span id="notification-message"></span>
        <span class="notification-close">&times;</span>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script>
    document.addEventListener('DOMContentLoaded', function() {
        const matrixToggle = document.getElementById('matrix-toggle');
        const clearCacheButton = document.getElementById('clear-cache-button');
        const notification = document.getElementById('notification');
        const notificationMessage = document.getElementById('notification-message');
        const notificationClose = document.querySelector('.notification-close');
        
        // Initialize toggle based on saved preference
        const matrixEnabled = localStorage.getItem('matrixEffectEnabled') !== 'false';
        matrixToggle.checked = matrixEnabled;
        
        // Toggle matrix effect when checkbox is changed
        matrixToggle.addEventListener('change', function() {
            window.toggleMatrixEffect(this.checked);
        });
        
        // Clear cache button
        clearCacheButton.addEventListener('click', function() {
            // Disable button during operation
            clearCacheButton.disabled = true;
            clearCacheButton.textContent = 'Clearing...';
            
            // Call the cache clear API
            fetch('/api/clear-cache', {
                method: 'POST'
            })
            .then(response => response.json())
            .then(data => {
                // Re-enable button
                clearCacheButton.disabled = false;
                clearCacheButton.textContent = 'Clear Cache';
                
                if (data.success) {
                    // Show success message
                    showNotification(data.message, 'success');
                } else {
                    // Show error message
                    showNotification(data.message || 'Failed to clear cache', 'error');
                }
            })
            .catch(error => {
                // Re-enable button
                clearCacheButton.disabled = false;
                clearCacheButton.textContent = 'Clear Cache';
                
                // Show error message
                showNotification('Error clearing cache: ' + error.message, 'error');
            });
        });
        
        // Show notification
        function showNotification(message, type = 'info') {
            notificationMessage.textContent = message;
            notification.className = 'notification';
            notification.classList.add(`notification-${type}`);
            notification.classList.remove('hidden');
            
            // Auto-hide after 3 seconds
            setTimeout(() => {
                notification.classList.add('hidden');
            }, 3000);
        }
        
        // Handle notification close button
        if (notificationClose) {
            notificationClose.addEventListener('click', function() {
                notification.classList.add('hidden');
            });
        }
    });
</script>
<style>
    /* Toggle Switch Styles */
    .toggle-switch {
        display: flex;
        align-items: center;
        margin: 10px 0;
    }
    
    .toggle-input {
        display: none;
    }
    
    .toggle-label {
        position: relative;
        display: inline-block;
        width: 60px;
        height: 34px;
        background-color: var(--bg-tertiary);
        border-radius: 34px;
        transition: 0.4s;
        cursor: pointer;
        margin-right: 10px;
    }
    
    .toggle-label:before {
        content: "";
        position: absolute;
        height: 26px;
        width: 26px;
        left: 4px;
        bottom: 4px;
        background-color: var(--text-secondary);
        border-radius: 50%;
        transition: 0.4s;
    }
    
    .toggle-input:checked + .toggle-label {
        background-color: var(--accent-color);
    }
    
    .toggle-input:checked + .toggle-label:before {
        transform: translateX(26px);
        background-color: white;
    }
    
    .toggle-text {
        color: var(--text-secondary);
    }
    
    /* Settings Description */
    .settings-description {
        color: var(--text-secondary);
        margin-bottom: 15px;
    }
    
    /* Notification */
    .notification {
        position: fixed;
        bottom: 20px;
        right: 20px;
        max-width: 350px;
        z-index: 1000;
        transition: transform 0.3s ease, opacity 0.3s ease;
        transform: translateY(0);
        opacity: 1;
    }
    
    .notification.hidden {
        transform: translateY(20px);
        opacity: 0;
        pointer-events: none;
    }
    
    .notification-content {
        padding: 12px 16px;
        background-color: var(--bg-secondary);
        color: var(--text-primary);
        border-radius: 4px;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.3);
        display: flex;
        align-items: center;
        justify-content: space-between;
    }
    
    .notification-close {
        margin-left: 10px;
        cursor: pointer;
        font-size: 18px;
        color: var(--text-secondary);
    }
    
    .notification-success .notification-content {
        border-left: 4px solid var(--success-color);
    }
    
    .notification-error .notification-content {
        border-left: 4px solid var(--error-color);
    }
    
    .notification-warning .notification-content {
        border-left: 4px solid var(--warning-color);
    }
    
    .notification-info .notification-content {
        border-left: 4px solid var(--accent-color);
    }
    
    /* Button Styles */
    .btn-warning {
        background-color: #e67e22;
        color: white;
    }
    
    .btn-warning:hover {
        background-color: #d35400;
    }
    
    .btn-warning:disabled {
        background-color: #f39c12;
        cursor: not-allowed;
    }
</style>
{% endblock %}